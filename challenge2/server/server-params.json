{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vmName": { "value": "vm-lab-challenge2" },
    "vmSize": { "value": "Standard_D2s_v3" },
    "adminUsername": { "value": "adminubuntu" },
    "adminPassword": { "value": "Temp0R4L!." },
    "vnetName": { "value": "vnet-lab-challenge2" },
    "subnetName": { "value": "services" },
    "privateIpAddress": { "value": "172.0.0.10" },
    "location": { "value": "westeurope" },

    "imagePublisher": { "value": "canonical" },
    "imageOffer": { "value": "ubuntu-24_04-lts" },
    "imageSku": { "value": "ubuntu-pro" },
    "imageVersion": { "value": "latest" },
    "cloudInitScript": {
      "value": "#cloud-config\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - apache2\n  - openssl\n\nruncmd:\n  - a2enmod ssl\n  - a2enmod rewrite\n  - mkdir -p /etc/apache2/ssl\n  - openssl req -x509 -nodes -days 365 -subj \"/C=US/ST=Example/L=Example/O=Example/CN=localhost\" -newkey rsa:2048 -keyout /etc/apache2/ssl/apache-selfsigned.key -out /etc/apache2/ssl/apache-selfsigned.crt\n  - |\n    cat > /etc/apache2/sites-available/default-ssl.conf <<'EOF'\n    <IfModule mod_ssl.c>\n        <VirtualHost _default_:443>\n            ServerAdmin webmaster@localhost\n            DocumentRoot /var/www/html\n\n            SSLEngine on\n            SSLCertificateFile /etc/apache2/ssl/apache-selfsigned.crt\n            SSLCertificateKeyFile /etc/apache2/ssl/apache-selfsigned.key\n\n            <Directory /var/www/html>\n                Options Indexes FollowSymLinks\n                AllowOverride All\n                Require all granted\n            </Directory>\n\n            ErrorLog ${APACHE_LOG_DIR}/error.log\n            CustomLog ${APACHE_LOG_DIR}/access.log combined\n        </VirtualHost>\n    </IfModule>\n    EOF\n  - a2ensite default-ssl\n  - systemctl restart apache2\n  - systemctl enable apache2"
    }
  }
}

